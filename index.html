<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Shopping Task</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#f6f7f9; --card:#fff; --text:#111; --muted:#666; --border:#e6e7ea; }
    body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--text); }
    .wrap { max-width: 980px; margin: 24px auto; padding: 16px; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:14px; padding:20px; box-shadow:0 6px 24px rgba(0,0,0,.05); }
    h1 { font-size:22px; margin:0 0 6px; }
    .muted { color:var(--muted); font-size:14px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:16px; }
    @media (max-width: 800px) { .grid { grid-template-columns: 1fr; } }
    .imgbox { border-radius:12px; border:1px solid var(--border); overflow:hidden; }
    .imgbox img { display:block; width:100%; height:auto; }
    .title { font-weight:650; font-size:20px; margin:0 0 6px; }
    .price { font-size:22px; font-weight:750; margin:8px 0 6px; }
    .bnpl { margin:0 0 12px; font-size:14px; background:#fbfbff; border:1px dashed #cfd2ff; padding:8px 10px; border-radius:8px; display:none; }
    .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:10px; }
    button { appearance:none; border-radius:10px; padding:12px 16px; border:1px solid var(--border); background:#f8f8f8; cursor:pointer; font-weight:600; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button:active { transform: translateY(1px); }
    .foot { margin-top:12px; font-size:12px; color:var(--muted); }
    .consent { background:#fffbe6; border:1px solid #ffe58f; padding:10px; border-radius:10px; margin:12px 0 0; font-size:13px; }
    .debug { margin-top:8px; font-size:12px; color:#999; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Shopping Task</h1>
      <div class="muted">Please interact with the page as you normally would, then press <b>Continue</b>.</div>

      <div class="consent">
        <b>Consent & Purpose.</b> We are studying how checkout design influences shopping decisions.
        Task: view a product page and choose what you would do, then answer brief questions.
        Time ~3–4 minutes. Compensation $0.40–$0.50. Minimal risk. Voluntary. Continuing indicates consent.
      </div>

      <div class="grid" style="margin-top:12px;">
        <div class="imgbox">
          <!-- Real product photo (stable Unsplash URL). Replace with your own anytime. -->
          <img id="productImg"
               src="https://images.unsplash.com/photo-1514477917009-389c76a86b68?q=80&w=1200&auto=format&fit=crop"
               alt="Daypack 22L backpack product photo" />
        </div>

        <div>
          <div class="title">Daypack 22L — Lightweight Travel Backpack</div>
          <ul class="muted" style="margin:6px 0 10px; padding-left:18px;">
            <li>Water-resistant, 22L capacity</li>
            <li>Separate laptop sleeve (up to 15")</li>
            <li>Weight 480g • 2-year warranty</li>
          </ul>

          <div class="price">$99.99</div>

          <!-- BNPL snippet toggled by condition -->
          <div class="bnpl" id="bnplBox">
            or <b>$24.99 × 4</b> with <span title="No interest if paid on time. Late fees may apply.">Pay in 4</span>
          </div>

          <div class="row">
            <button id="addCartBtn">Add to Cart</button>
            <button id="checkoutBtn" class="primary">Proceed to Checkout</button>
            <button id="moreInfoBtn">More Info</button>
            <button id="continueBtn">Continue</button>
          </div>

          <div class="foot">One version shows Pay-in-4; another does not. Each person sees only one version.</div>
          <div class="debug" id="debugLine" style="display:none;"></div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  // ======= SET THIS TO YOUR REAL SURVEY LINK =======
  const QUALTRICS_URL = "https://mcgillmgmt.az1.qualtrics.com/jfe/form/SV_dmuuCk1GLKruA98";
  // ================================================

  // Read params & allow override for testing (?cond=A or ?cond=B, ?debug=1)
  const qs = new URLSearchParams(location.search);
  const workerId    = qs.get("workerId")    || qs.get("worker") || "unknown";
  const assignmentId= qs.get("assignmentId")|| "unknown";
  const hitId       = qs.get("hitId")       || "unknown";
  const override    = (qs.get("cond") || "").toUpperCase();
  const debugOn     = qs.get("debug") === "1";

  let condition = (override === "A" || override === "B") ? override : (Math.random() < 0.5 ? "A" : "B");
  const bnplShown = (condition === "B");

  // Show/hide BNPL row
  const bnplBox = document.getElementById("bnplBox");
  if (bnplShown) bnplBox.style.display = "inline-block";

  // Click logging
  const t0 = performance.now();
  const clicks = { addCart:0, checkout:0, moreInfo:0, firstClickMs:null };
  const mark = key => { clicks[key] += 1; if (clicks.firstClickMs === null) clicks.firstClickMs = Math.round(performance.now()-t0); };

  document.getElementById("addCartBtn").onclick  = () => mark("addCart");
  document.getElementById("checkoutBtn").onclick = () => mark("checkout");
  document.getElementById("moreInfoBtn").onclick = () => { mark("moreInfo"); alert("Free shipping over $50. 30-day returns."); };

  document.getElementById("continueBtn").onclick = () => {
    const totalMs = Math.round(performance.now() - t0);
    const ctaClicked = (clicks.addCart>0 || clicks.checkout>0) ? 1 : 0;

    if (!/^https?:\/\//.test(QUALTRICS_URL)) {
      alert("Set QUALTRICS_URL in the HTML to your live survey link.");
      return;
    }

    const p = new URLSearchParams({
      workerId, assignmentId, hitId,
      condition,
      bnplShown: bnplShown ? "1" : "0",
      addCart: String(clicks.addCart),
      checkout: String(clicks.checkout),
      moreInfo: String(clicks.moreInfo),
      firstClickMs: String(clicks.firstClickMs ?? ""),
      totalMs: String(totalMs),
      ctaClicked: String(ctaClicked)
    });

    location.href = QUALTRICS_URL + (QUALTRICS_URL.includes("?") ? "&" : "?") + p.toString();
  };

  // Optional on-page debug
  if (debugOn) {
    const dbg = document.getElementById("debugLine");
    dbg.style.display = "block";
    dbg.textContent = `Condition=${condition} (bnplShown=${bnplShown ? "1":"0"})  |  Clicks: ${JSON.stringify(clicks)}`;
  }
})();
</script>
</body>
</html>
