<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Shopping Task</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#f6f7f9; --card:#fff; --text:#111; --muted:#666; --border:#e6e7ea; }
    body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--text); }
    .wrap { max-width: 980px; margin: 24px auto; padding: 16px; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:14px; padding:20px; box-shadow:0 6px 24px rgba(0,0,0,.05); }
    h1 { font-size:20px; margin:0 0 6px; }
    .muted { color:var(--muted); font-size:14px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:16px; }
    @media (max-width: 800px) { .grid { grid-template-columns: 1fr; } }
    .imgbox { background:#ddd; border-radius:12px; aspect-ratio: 4/3; display:flex; align-items:center; justify-content:center; color:#555; font-size:14px; border:1px solid var(--border); }
    .title { font-weight:600; font-size:20px; margin:0 0 4px; }
    .price { font-size:22px; font-weight:700; margin:6px 0; }
    .bnpl { margin:0 10px 10px 0; font-size:14px; background:#fbfbff; border:1px dashed #cfd2ff; padding:8px 10px; border-radius:8px; display:none; }
    .tooltip { text-decoration:underline; cursor:pointer; }
    .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    button { appearance:none; border-radius:10px; padding:12px 16px; border:1px solid var(--border); background:#f8f8f8; cursor:pointer; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button[disabled] { opacity:.5; cursor:not-allowed; }
    .foot { margin-top:12px; font-size:12px; color:var(--muted); }
    .consent { background:#fffbe6; border:1px solid #ffe58f; padding:10px; border-radius:10px; margin:12px 0 0; font-size:13px; }
    .notice { background:#eef7ff; border:1px solid #cfe6ff; padding:10px; border-radius:10px; margin:12px 0; font-size:13px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Shopping Task</h1>
      <div class="muted">Please interact with the page as you normally would, then press <b>Continue</b>.</div>
      <div id="previewNotice" class="notice" style="display:none;">
        You are previewing this HIT. Please <b>Accept</b> the HIT on MTurk to start.
      </div>

      <div class="consent">
        <b>Consent & Purpose.</b> We are studying how checkout design influences shopping decisions.
        Task: view a product page and choose what you would do, then answer brief questions.
        Time ~3–4 minutes. Compensation $0.40–$0.50. Minimal risk. Voluntary participation.
        Continuing indicates consent.
      </div>

      <div class="grid" style="margin-top:12px;">
        <div class="imgbox" id="imgbox" aria-label="Product image placeholder">Product image</div>
        <div>
          <div class="title" id="prodTitle">Daypack 22L — Lightweight Travel Backpack</div>
          <ul class="muted" style="margin:6px 0 10px; padding-left:18px;">
            <li>Water-resistant, 22L capacity</li>
            <li>Separate laptop sleeve (up to 15")</li>
            <li>Weight 480g • 2-year warranty</li>
          </ul>
          <div class="price" id="price">$99.99</div>

          <div class="bnpl" id="bnplBox" role="note" aria-live="polite">
            or <b>$24.99 × 4</b> with <span class="tooltip" id="bnplInfo" title="No interest if paid on time. Late fees may apply.">Pay in 4</span>
          </div>

          <div class="row" style="margin-top:8px;">
            <button id="addCartBtn">Add to Cart</button>
            <button id="checkoutBtn" class="primary">Proceed to Checkout</button>
            <button id="moreInfoBtn">More Info</button>
            <button id="continueBtn">Continue</button>
          </div>

          <div class="foot">One version shows Pay-in-4; another does not. You will only see one version.</div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  // ======= CONFIG: EDIT THIS =======
  const QUALTRICS_URL = "https://YOUR-QUALTRICS-LINK/jfe/form/FORMID";
  // (Optional) use Figma PNGs later:
  const USE_FIGMA_IMAGES = false;
  const IMG_A = "ui_A_no_bnpl.png";
  const IMG_B = "ui_B_with_bnpl.png";
  // =================================

  // Read MTurk params if present
  const qs = new URLSearchParams(location.search);
  const workerId = qs.get("workerId") || qs.get("worker") || "unknown";
  const assignmentId = qs.get("assignmentId") || "unknown";
  const hitId = qs.get("hitId") || "unknown";
  const isPreview = assignmentId === "ASSIGNMENT_ID_NOT_AVAILABLE";

  // Randomize condition (A=no BNPL, B=BNPL)
  const condition = (Math.random() < 0.5) ? "A" : "B";
  const bnplShown = (condition === "B");

  // DOM refs
  const bnplBox = document.getElementById("bnplBox");
  const imgbox = document.getElementById("imgbox");
  const previewNotice = document.getElementById("previewNotice");
  const addCartBtn = document.getElementById("addCartBtn");
  const checkoutBtn = document.getElementById("checkoutBtn");
  const moreInfoBtn = document.getElementById("moreInfoBtn");
  const continueBtn = document.getElementById("continueBtn");
  const bnplInfo = document.getElementById("bnplInfo");

  // Preview lock (MTurk)
  if (isPreview) {
    previewNotice.style.display = "block";
    [addCartBtn, checkoutBtn, moreInfoBtn, continueBtn].forEach(b => b.disabled = true);
  }

  // Apply condition
  if (bnplShown) bnplBox.style.display = "inline-block";
  if (USE_FIGMA_IMAGES) {
    imgbox.style.background = center/cover no-repeat url('${bnplShown ? IMG_B : IMG_A}');
    imgbox.textContent = "";
    imgbox.setAttribute("aria-label", "Product mockup");
  }

  // Telemetry
  const t0 = performance.now();
  const clicks = { addCart:0, checkout:0, moreInfo:0, firstClickMs:null };
  const mark = k => { clicks[k] += 1; if (clicks.firstClickMs===null) clicks.firstClickMs = Math.round(performance.now()-t0); };

  addCartBtn.onclick  = () => mark("addCart");
  checkoutBtn.onclick = () => mark("checkout");
  moreInfoBtn.onclick = () => { mark("moreInfo"); alert("Free shipping over $50. 30-day returns."); };
  bnplInfo.onclick    = () => alert("Pay over 4 interest-free payments if paid on time. Late fees may apply.");

  continueBtn.onclick = () => {
    if (isPreview) { alert("Please Accept the HIT on MTurk to begin."); return; }
    const totalMs = Math.round(performance.now() - t0);
    const ctaClicked = (clicks.addCart>0 || clicks.checkout>0) ? 1 : 0;

    const p = new URLSearchParams({
      workerId, assignmentId, hitId,
      condition,
      bnplShown: bnplShown ? "1" : "0",
      addCart: String(clicks.addCart),
      checkout: String(clicks.checkout),
      moreInfo: String(clicks.moreInfo),
      firstClickMs: String(clicks.firstClickMs ?? ""),
      totalMs: String(totalMs),
      ctaClicked: String(ctaClicked)
    });

    const url = QUALTRICS_URL + (QUALTRICS_URL.includes("?") ? "&" : "?") + p.toString();
    location.href = url;
  };
})();
</script>
</body>
</html>
